{% extends "base.html" %}

{% block title %} Candidaturas {% endblock %}

{% block scripts %}
<script>
	$(document).ready(function() {
        
        //--
        $(".vote-first").click(function(e){
            e.preventDefault();
            
            changeFirstVoteSelected($(this));
            
            //--
            function changeFirstVoteSelected(elem)
            {
                var candidateId;
                
                candidateId = elem.attr('id');
                candidateId = candidateId.split('-')[1];
                
                var imagSrc = "static/images/icon-user-default.png";
                if(elem.hasClass("vote_selected"))
                {
                    $(".vote-first").removeClass("disabled");
                    elem.removeClass("vote_selected");
                    candidateId = 0;
                }
                else
                {
                    $(".vote-first").removeClass("vote_selected");
                    $(".vote-first").addClass("disabled");
                    elem.removeClass("disabled");
                    elem.addClass("vote_selected");

                    imagSrc = $("img#candidate-image-"+candidateId).attr('src');
                }

                //--
                $("li#first-candidate-item span img.candidate_img").attr('src', imagSrc);
                $("li#first-candidate-item span img.candidate_img").attr('candidate', candidateId);
                
                elem.blur();
            }
        });
        
        //--
        $(".vote-option").click(function(e){
            e.preventDefault();
            
            
            $(this).siblings(".vote_selected").each(function(n, elem){
                changeVoteSelected($(elem));
            });
            
            changeVoteSelected($(this));
            
            
            //--
            function changeVoteSelected(elem)
            {
                var voteId;
                var candidateId;
                
                voteId      = elem.attr('id');
                candidateId = voteId.split('_')[0];
                voteId      = voteId.split('_')[1];
                candidateId = candidateId.split('-')[1];
                voteId      = voteId.split('-')[1];
                
                var imagSrc = "static/images/icon-user-default.png";
                if(elem.hasClass("vote_selected"))
                {
                    $(".vote-option-" + voteId).removeClass("disabled");
                    elem.removeClass("vote_selected");
                    elem.parents(".media-body").find(".vote-asigned").removeClass("remark").html("");
                    candidateId = 0;
                }
                else
                {
                    $(".vote-option-" + voteId).removeClass("vote_selected");
                    $(".vote-option-" + voteId).addClass("disabled");
                    elem.removeClass("disabled");
                    elem.addClass("vote_selected");
                    elem.parents(".media-body").find(".vote-asigned").addClass("remark").html(elem.html());
                    
                    imagSrc = $("img#candidate-image-"+candidateId).attr('src');
                }

                //--
                $("li#candidate-item-" + voteId + " span img.candidate_img").attr('src', imagSrc);
                $("li#candidate-item-" + voteId + " span img.candidate_img").attr('candidate', candidateId);
                
                elem.blur();
            }
        });
        

        $("img.candidate_img").click(function(e){
            e.preventDefault();
            
            var candidateId = parseInt($(this).attr('candidate'), 10);
            if(candidateId > 0)
            {
                var block = $("#candidate-block-"+candidateId);
                if(block)
                {
                    $('html, body').animate({
                        scrollTop: block.offset().top - 80
                    });
                }
            }
        });
	});
</script>
{% endblock %}


{% block candidate_list %}
{%if candidates %}
	<div class="row candidate">
		<div class="col-xs-12 hidden-sm candidate-selected-container">
            <ul class="candidate-selected-list">
                <li class="candidate-selected-placeholder" id="first-candidate-item"><span><div></div><img class="candidate_img" src="static/images/icon-user-default.png" /></span></li>
                {% for i in 1..8 %}
                <li class="candidate-selected-placeholder" id="candidate-item-{{i}}"><span><div>1/{{i}}</div><img class="candidate_img" src="static/images/icon-user-default.png" /></span></li>
                {% endfor %}
            </ul>
        </div>
    </div>
{% endif %}
{% endblock %}

{% block main_container %}
	<div class="row">
		<div class="col-xs-12">
			<h1 class="center">Listado de candidaturas <a href="#" alt="Ayuda" target="_blank"><i class="fa fa-info-circle"></i></a></h1>
            
            {%if candidates %}
            <ul class="list-group candidateGroup">
                {% for candidate in candidates %}
                <li class="list-group-item candidateItem" id="candidate-block-{{candidate.id}}">
                    <div class="media">
                        <div class="media-left media-middle"><a href="{{candidate.url_detalle}}" alt="Abrir perfil del candidato" target="_blank"><img id="candidate-image-{{candidate.id}}" class="media-object candidate_img" src="{{candidate.url_foto}}" /></a></div>
                        <div class="media-body">
                            <h4><span class="vote-asigned"></span> <a href="{{candidate.url_detalle}}" alt="Abrir perfil del candidato" target="_blank">{{candidate.nombre}} <i class="fa fa-arrow-right"></i></a></h4>
                            <p>{{candidate.descripcion | raw}}</p>

                            <div class="btn-toolbar pull-right" role="toolbar" aria-label="vote">
                                <button type="button" id="cl-{{candidate.id}}" class="btn btn-primary vote-first pull-left">Cabeza</button>
                                <div id="vote-panel-{{candidate.id}}" class="btn-group vote-panel" role="group" aria-label="votation-group">
                                    <button type="button" id="c-{{candidate.id}}_o-1" class="btn btn-default vote-option vote-option-1 ">1</button>
                                    <button type="button" id="c-{{candidate.id}}_o-2" class="btn btn-default vote-option vote-option-2 ">1/2</button>
                                    <button type="button" id="c-{{candidate.id}}_o-3" class="btn btn-default vote-option vote-option-3 ">1/3</button>
                                    <button type="button" id="c-{{candidate.id}}_o-4" class="btn btn-default vote-option vote-option-4 ">1/4</button>
                                    <button type="button" id="c-{{candidate.id}}_o-5" class="btn btn-default vote-option vote-option-5 ">1/5</button>
                                    <button type="button" id="c-{{candidate.id}}_o-6" class="btn btn-default vote-option vote-option-6 ">1/6</button>
                                    <button type="button" id="c-{{candidate.id}}_o-7" class="btn btn-default vote-option vote-option-7 ">1/7</button>
                                    <button type="button" id="c-{{candidate.id}}_o-8" class="btn btn-default vote-option vote-option-8 ">1/8</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </li>
                {% endfor %}
            </ul>
            
            
            <button id="button_login" type="submit" class="btn btn-block signin disabled">Votar</button>
            
            
            {% else %}
            
            <div class="panel panel-default">
                <div class="panel-body">
                    <p>El proceso electoral todav√≠a no esta en marcha. Por favor, vuelva en las fechas indicadas.</p>
                </div>
            </div>
            {% endif %}            
		</div>
	</div>
{% endblock %}

